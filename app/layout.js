'use client';


import LenisProvider from './components/LenisProvider';
import Header from './components/Header';
import { useRouter } from 'next/navigation';
import { useEffect, useRef } from 'react';
// import NavigationTransition from './components/NavigationTransition';
import "./main.scss";

export default function RootLayout({ children }) {

  const router = useRouter();
  const mainRef = useRef(null);

  useEffect(() => {
    if (!document.startViewTransition) return;

    const handleClick = (e) => {
      const link = e.target.closest('a[href]');
      if (!link) return;

      const url = link.getAttribute('href');

      // internal links only
      if (!url.startsWith('/')) return;

      e.preventDefault();

      document.documentElement.classList.add('is-route-transition');
      const transition = document.startViewTransition(() => {
        window.lenis?.scrollTo(0, { immediate: true });
        router.push(url);
      });
      transition.finished.finally(() => {
        document.documentElement.classList.remove('is-route-transition');
      });
    };

    document.addEventListener('click', handleClick);
    return () => document.removeEventListener('click', handleClick);
  }, [router]);

  return (
    <html lang="en">
      <body>
        {/* <NavigationTransition /> */}
        <Header/>
        <LenisProvider>
        <main ref={mainRef} className="view-stage">{children}</main>
        </LenisProvider>
      </body>
    </html>
  );
}
